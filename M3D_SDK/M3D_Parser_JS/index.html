<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <title>Load M3D</title>

    <script type="text/javascript" src="./libs/Cesium/Cesium.js"></script>
    <script type="text/javascript" src="./dist/m3d-layer-min.js"></script>
</head>

<body>
    <style>
        @import url(libs/Cesium/Widgets/widgets.css);

        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <div id="cesiumContainer" class="fullSize"></div>
    <script id="cesium_sandcastle_script">
        function startup(Cesium) {
            'use strict';

            const viewer = new Cesium.Viewer('cesiumContainer', {
                terrainExaggeration: 1,
                requestRenderMode: true,
                animation: true,
                timeline: true
            });

            let url = './data/景观_建筑模型/景观_建筑模型.mcj';

            let m3dLayer = new CesiumZondy.M3D.MapGISM3DSet({
                context: viewer.scene._context,
                maximumScreenSpaceError: 8,
                url: url
            });

            let tileset = viewer.scene.primitives.add(m3dLayer);
            return tileset.readyPromise.then(function (tileset1) {
                let boundingSphere = tileset.boundingSphere;
                viewer.camera.viewBoundingSphere(boundingSphere, new Cesium.HeadingPitchRange(
                    0.0, -0.5,
                    boundingSphere.radius));
                viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
                let cartographic = Cesium.Cartographic.fromCartesian(tileset.boundingSphere.center);
                let surface = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, 0.0);
                let offset = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, -0.5);
                let translation = Cesium.Cartesian3.subtract(offset, surface, new Cesium.Cartesian3());
                tileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation);
            }).otherwise(function (error) {
                throw (error);
            });
        }

        if (typeof Cesium !== 'undefined') {
            startup(Cesium);
        } else if (typeof require === 'function') {
            require(['Cesium'], startup);
        }
    </script>
</body>

</html>
